<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Booking a Table | Modern Restaurant</title>
        <link rel="stylesheet" href="/booking_table.css" />
    </head>
    <body>
        <div class="container">
            <h1>Book a Table</h1>
            <a href="/">Back to Home</a>


            <form action="/booking" method="POST" id="bookingForm">
                <div class="form-grid">
                    <div>
                        <label for="customerName">Name:</label>
                        <input
                            type="text"
                            name="customerName"
                            id="customerName"
                            required
                            placeholder="Your full name"
                        />
                    </div>
                    
                    <div>
                        <label for="people">Number of People:</label>
                        <select name="people" id="people" required>
                            <option value="" disabled selected>Select number of people</option>
                            <option value="1">1 person</option>
                            <option value="2">2 people</option>
                            <option value="3">3 people</option>
                            <option value="4">4 people</option>
                            <option value="5">5 people</option>
                            <option value="6">6 people</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="date">Date:</label>
                        <input
                            type="date"
                            name="date"
                            id="date"
                            value="<%= selectedDate %>"
                            required
                            min="<%= new Date().toISOString().split('T')[0] %>"
                            onchange="window.location.href='/booking?date=' + this.value;"
                        />
                    </div>
                    
                    <div>
                        <label for="time">Time:</label>
                        <input
                            type="time"
                            name="time"
                            id="time"
                            required
                            min="09:00"
                            max="21:00"
                        />
                    </div>
                    
                    <div class="form-grid-full">
                        <button type="button" id="togglePreOrder">Toggle Pre-Order Options</button>
                        <div id="preOrderList">
                            <div class="pre-order-container">
                                <% const preOrderItems = ["Water", "Wine", "Sparkling Water", "Flowers", "Candles", "Coffee", "Champagne", "Dessert"]; 
                                preOrderItems.forEach(item => { %>
                                <div class="pre-order-card" data-item="<%= item %>">
                                    <input
                                        type="checkbox"
                                        id="<%= item %>"
                                        class="pre-order-checkbox"
                                        value="<%= item %>"
                                        style="display: none"
                                    />
                                    <label for="<%= item %>" class="pre-order-label">
                                        <%= item %>
                                    </label>
                                </div>
                                <% }); %>
                            </div>
                        </div>
                        <input type="hidden" name="preOrder" id="preOrderInput" />
                    </div>
                </div>

                <h2>Select a Table</h2>
                
                <!-- Restaurant Floor Plan with Zones -->
                <div class="restaurant-floor-plan">
                    <div class="restaurant-walls"></div>
                    <div class="window-area"></div>
                    <div class="bar-area">Bar</div>
                    <div class="booth-area"></div>
                    <div class="kitchen-area">Kitchen</div>
                    <div class="entrance"></div>
                    
                    <!-- Floor zones -->
                    <div class="window-zone"></div>
                    <div class="center-zone"></div>
                    <div class="bar-zone"></div>
                    <div class="booth-zone"></div>
                    
                    <!-- Table layout -->
                    <div class="table-layout">
                        <!-- Window tables -->
                        <div class="table-card window table-1 <%= occupiedTables.some(table => table.tableNumber === 1) ? 'occupied' : '' %>" data-table-number="1">
                            <span>1</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Window</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card window table-2 <%= occupiedTables.some(table => table.tableNumber === 2) ? 'occupied' : '' %>" data-table-number="2">
                            <span>2</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Window</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card window table-3 <%= occupiedTables.some(table => table.tableNumber === 3) ? 'occupied' : '' %>" data-table-number="3">
                            <span>3</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Window</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card window table-4 <%= occupiedTables.some(table => table.tableNumber === 4) ? 'occupied' : '' %>" data-table-number="4">
                            <span>4</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Window</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <!-- Center tables -->
                        <div class="table-card center round table-5 <%= occupiedTables.some(table => table.tableNumber === 5) ? 'occupied' : '' %>" data-table-number="5">
                            <span>5</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Center</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        
                        <div class="table-card center round table-6 <%= occupiedTables.some(table => table.tableNumber === 6) ? 'occupied' : '' %>" data-table-number="6">
                            <span>6</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Center</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card center table-7 <%= occupiedTables.some(table => table.tableNumber === 7) ? 'occupied' : '' %>" data-table-number="7">
                            <span>7</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Center</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card center table-8 <%= occupiedTables.some(table => table.tableNumber === 8) ? 'occupied' : '' %>" data-table-number="8">
                            <span>8</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Center</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <!-- Booth tables -->
                        <div class="table-card booth rectangle table-9 <%= occupiedTables.some(table => table.tableNumber === 9) ? 'occupied' : '' %>" data-table-number="9">
                            <span>9</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Booth</div>
                            <div class="table-capacity">2 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card booth rectangle table-10 <%= occupiedTables.some(table => table.tableNumber === 10) ? 'occupied' : '' %>" data-table-number="10">
                            <span>10</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Booth</div>
                            <div class="table-capacity">2 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <!-- Bar tables -->
                        <div class="table-card bar table-11 <%= occupiedTables.some(table => table.tableNumber === 11) ? 'occupied' : '' %>" data-table-number="11">
                            <span>11</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Bar</div>
                            <div class="table-capacity">3 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        
                        <div class="table-card bar table-12 <%= occupiedTables.some(table => table.tableNumber === 12) ? 'occupied' : '' %>" data-table-number="12">
                            <span>12</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Bar</div>
                            <div class="table-capacity">3 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                        <!-- Entrance tables -->
                        <div class="table-card entrance table-13 <%= occupiedTables.some(table => table.tableNumber === 13) ? 'occupied' : '' %>" data-table-number="13">
                            <span>13</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Entrance</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>

                        <div class="table-card entrance table-14 <%= occupiedTables.some(table => table.tableNumber === 14) ? 'occupied' : '' %>" data-table-number="14">
                            <span>14</span>
                            <div class="table-surface"></div>
                            <div class="table-location">Entrance</div>
                            <div class="table-capacity">4 ppl</div>
                            <div class="chairs">
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                                <div class="chair"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Floor legend -->
                    <div class="floor-legend">
                        <div class="legend-item">
                            <div class="legend-color window"></div>
                            <span>Window Tables</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color center"></div>
                            <span>Center Tables</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color booth"></div>
                            <span>Booth Tables</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color bar"></div>
                            <span>Bar Tables</span>
                        </div>
                    </div>
                </div>

                <input type="hidden" name="tableNumber" id="selectedTableNumber" required />
                
                <button type="submit">Book Now</button>
            </form>

            <h2>Occupied Tables for <%= selectedDate %></h2>
            <ul>
                <% if (occupiedTables && occupiedTables.length > 0) { %> 
                    <% occupiedTables.forEach(function(table) { %>
                    <li>
                        <div>
                            <strong>Table Number:</strong> <%= table.tableNumber %><br>
                            <strong>Time:</strong> <%= table.time %>
                        </div>
                        <div>
                            <strong>Customer:</strong> <%= table.customerName %><br>
                            <strong>People:</strong> <%= table.people %>
                        </div>
                    </li>
                    <% }) %>
                <% } else { %>
                    <p>No reservations for this date.</p>
                <% } %>
            </ul>
        </div>

        <footer>
            <p>&copy; 2025 Modern Restaurant. All rights reserved.</p>
            <div>
                <a >Privacy Policy</a>
                <a >Terms of Service</a>
                <a >Contact Us</a>
            </div>
        </footer>

        <script>
            const tableCards = document.querySelectorAll(".table-card:not(.occupied)");
            const selectedTableNumberInput = document.getElementById("selectedTableNumber");

            tableCards.forEach((card) => {
                card.addEventListener("click", () => {
                    const tableNumber = card.dataset.tableNumber;
                    selectedTableNumberInput.value = tableNumber;
                    tableCards.forEach((c) => c.classList.remove("selected"));
                    card.classList.add("selected");
                });
            });

            const togglePreOrderButton = document.getElementById("togglePreOrder");
            const preOrderList = document.getElementById("preOrderList");

            // Load the state from localStorage
            const isPreOrderListVisible = localStorage.getItem("isPreOrderListVisible") === "true";
            preOrderList.style.display = isPreOrderListVisible ? "block" : "none";

            togglePreOrderButton.addEventListener("click", () => {
                if (preOrderList.style.display === "none") {
                    preOrderList.style.display = "block";
                    localStorage.setItem("isPreOrderListVisible", "true");
                } else {
                    preOrderList.style.display = "none";
                    localStorage.setItem("isPreOrderListVisible", "false");
                }
            });

            const preOrderCards = document.querySelectorAll(".pre-order-card");
            const preOrderInput = document.getElementById("preOrderInput");
            let selectedPreOrders = [];

            // Load any previously selected pre-orders
            preOrderCards.forEach((card) => {
                const itemValue = card.dataset.item;
                if (localStorage.getItem(`preOrder_${itemValue}`) === "true") {
                    card.classList.add("selected");
                    selectedPreOrders.push(itemValue);
                }
            });
            
            // Update hidden input with initial values
            preOrderInput.value = selectedPreOrders.join(", ");

            preOrderCards.forEach((card) => {
                card.addEventListener("click", () => {
                    // Toggle card selection
                    card.classList.toggle("selected");
                    
                    // Get value
                    const itemValue = card.dataset.item;
                    
                    // Update selected items list
                    if (card.classList.contains("selected")) {
                        // Add to array if selected
                        if (!selectedPreOrders.includes(itemValue)) {
                            selectedPreOrders.push(itemValue);
                        }
                        localStorage.setItem(`preOrder_${itemValue}`, "true");
                    } else {
                        // Remove from array if unselected
                        selectedPreOrders = selectedPreOrders.filter(item => item !== itemValue);
                        localStorage.removeItem(`preOrder_${itemValue}`);
                    }
                    
                    // Update hidden input value
                    preOrderInput.value = selectedPreOrders.join(", ");
                });
            });

            // Form validation
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                if (!document.getElementById('selectedTableNumber').value) {
                    e.preventDefault();
                    alert('Please select a table');
                }
            });
        </script>
    </body>
</html>